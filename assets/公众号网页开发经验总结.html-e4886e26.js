import{_ as t,r as o,o as p,c,a as n,b as s,d as e,e as i}from"./app-00a966d3.js";const l={},u=n("h1",{id:"公众号网页开发经验总结",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#公众号网页开发经验总结","aria-hidden":"true"},"#"),s(" 公众号网页开发经验总结")],-1),r=n("h2",{id:"内网穿透",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#内网穿透","aria-hidden":"true"},"#"),s(" 内网穿透")],-1),d={href:"https://www.ngrok.cc",target:"_blank",rel:"noopener noreferrer"},k=n("li",null,[n("p",null,[s("修改 webpack-dev-server 的 "),n("code",null,"disableHostCheck: true")])],-1),v=n("h2",{id:"移动端调试神器",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#移动端调试神器","aria-hidden":"true"},"#"),s(" 移动端调试神器")],-1),m=n("ul",null,[n("li",null,"VConsole：https://github.com/Tencent/vConsole")],-1),h=n("h2",{id:"微信公众号开发文档",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#微信公众号开发文档","aria-hidden":"true"},"#"),s(" 微信公众号开发文档")],-1),_={href:"https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Overview.html3",target:"_blank",rel:"noopener noreferrer"},g={href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html",target:"_blank",rel:"noopener noreferrer"},b=i(`<h2 id="如何让网页只在微信内打开" tabindex="-1"><a class="header-anchor" href="#如何让网页只在微信内打开" aria-hidden="true">#</a> 如何让网页只在微信内打开</h2><ol><li><p>通过 userAgent 判断</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 判断是否是微信环境</span>
<span class="token keyword">function</span> <span class="token function">getIsWxClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ua<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">MicroMessenger</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;micromessenger&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><ol start="2"><li><p>通过 WeixinJSBridge 判断(推荐)</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 需要在JS-SDK加载之后判断</span>
<span class="token keyword">function</span> <span class="token function">getIsWxClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> WeixinJSBridge <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h2 id="公众号内保持登录状态" tabindex="-1"><a class="header-anchor" href="#公众号内保持登录状态" aria-hidden="true">#</a> 公众号内保持登录状态</h2><p>微信内网页不可使用 local/sessionStorage 储存，因为它只是一个 webview 组件，并不是一个浏览器。 但是我们可以使用 cookie 储存的方式</p><p>参考：关于微信中的 localStorage 及使用 cookie 的解决方案：https://my.oschina.net/crazymus/blog/425650</p><p>方法：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//设置cookie</span>
<span class="token keyword">function</span> <span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token parameter">c_name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> expiredays</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> exdate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  exdate<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span>exdate<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> expiredays<span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>cookie <span class="token operator">=</span>
    c_name <span class="token operator">+</span>
    <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span>
    <span class="token function">escape</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">+</span>
    <span class="token punctuation">(</span>expiredays <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token string">&quot;&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;;expires=&quot;</span> <span class="token operator">+</span> exdate<span class="token punctuation">.</span><span class="token function">toGMTString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//取回cookie</span>
<span class="token keyword">function</span> <span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token parameter">c_name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> c_start <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>c_name <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>c_start <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      c_start <span class="token operator">=</span> c_start <span class="token operator">+</span> c_name<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      c_end <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;;&quot;</span><span class="token punctuation">,</span> c_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>c_end <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> c_end <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">unescape</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>c_start<span class="token punctuation">,</span> c_end<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//设置cookie，有效期为365天</span>
<span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> <span class="token number">365</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//取回，若cookie失效，将返回空</span>
<span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同样的，也可以做登录状态保存。</p><h2 id="ios-端的时间格式问题" tabindex="-1"><a class="header-anchor" href="#ios-端的时间格式问题" aria-hidden="true">#</a> ios 端的时间格式问题</h2><p>在做移动端开发的时候，使用 new Date() 转换后台返回的格式时，在 chrome 之类浏览器和安卓手机上都显示正常，但是在 iOS 上显示 Invalid Date。 例如: <code>new Date(“2020-05-25 11:11:11”).getTime()</code> 正常情况下可以获取时间戳，但是在 iOS 端解析不了。<br> 后来查找发现 iOS 只识别 <code>yyyy/mm/dd</code> 这类斜杠格式的日期。<br> 解决办法：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>freedomTime <span class="token operator">=</span> freedomTime<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">-</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>freedomTime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="判断设备" tabindex="-1"><a class="header-anchor" href="#判断设备" aria-hidden="true">#</a> 判断设备</h2>`,15),f={href:"http://nodei.co/npm/mobile-device-detect/",target:"_blank",rel:"noopener noreferrer"},x=n("h2",{id:"扫码关注公众号登录网站",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#扫码关注公众号登录网站","aria-hidden":"true"},"#"),s(" 扫码关注公众号登录网站")],-1),w={href:"https://developers.weixin.qq.com/doc/offiaccount/Account_Management/Generating_a_Parametric_QR_Code.html",target:"_blank",rel:"noopener noreferrer"},q={href:"https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Receiving_event_pushes.html",target:"_blank",rel:"noopener noreferrer"},y={href:"https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Receiving_event_pushes.html",target:"_blank",rel:"noopener noreferrer"},S={href:"https://developers.weixin.qq.com/doc/offiaccount/User_Management/Get_users_basic_information_UnionID.html#UinonId",target:"_blank",rel:"noopener noreferrer"},j={href:"https://developers.weixin.qq.com/doc/offiaccount/User_Management/Getting_a_User_List.html",target:"_blank",rel:"noopener noreferrer"},C=n("li",null,"总结逻辑：用户通过扫码生成带有参数的二维码后可以获得微信的推送，拿到 openid 和订阅状态，然后通过 openid 可以获取 unionid 和微信基本信息，在与我们的数据做一个绑定，然后订阅之后可以获得推送，判断已经订阅就给他返回登录态（前端轮询/webStoket）。",-1),D=n("h2",{id:"微信-h5-页面兼容的坑",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#微信-h5-页面兼容的坑","aria-hidden":"true"},"#"),s(" 微信 H5 页面兼容的坑")],-1),M=n("ul",null,[n("li",null,"ios 端兼容 input 光标高度"),n("li",null,"ios 端微信 H5 上下滑动时卡顿，页面丢失"),n("li",null,"ios 键盘唤起，键盘收起以后页面不归位"),n("li",null,"安卓弹出的键盘遮盖文本框"),n("li",null,"Vue 中路由使用 hash 模式，开发微信 H5 页面分享时在安卓上设置分享成功，但是 ios 的分享异常")],-1),O={href:"https://segmentfault.com/a/1190000019986963",target:"_blank",rel:"noopener noreferrer"};function T(I,V){const a=o("ExternalLinkIcon");return p(),c("div",null,[u,r,n("ul",null,[n("li",null,[n("p",null,[s("sunny-Ngrok："),n("a",d,[s("https://www.ngrok.cc"),e(a)])])]),k]),v,m,h,n("ul",null,[n("li",null,[n("a",_,[s("公众号开发文档"),e(a)])]),n("li",null,[n("a",g,[s("JS-WX-SDK 文档"),e(a)])])]),b,n("p",null,[s("需要解决 iOS 和安卓的兼容，首先你的判断当前的设备类型，可以使用"),n("a",f,[s("mobile-device-detect "),e(a)]),s("这个库来判断。")]),x,n("ol",null,[n("li",null,[s("生成带参数的二维码 "),n("ol",null,[n("li",null,[n("a",w,[s("生成二维码"),e(a)])])])]),n("li",null,[s("用户扫描二维码 "),n("ol",null,[n("li",null,[n("a",q,[s("用户扫码后-获取用户 openid"),e(a)]),s("获取")]),n("li",null,[n("a",y,[s("用户关注/取关推送"),e(a)]),s("获取 openid 和关注状况")])])]),n("li",null,[s("关注后获取用户 openid "),n("ol",null,[n("li",null,[n("a",S,[s("通过 openid 获取用户基本信息"),e(a)]),s("，可根据 openid 和 unionid 添加到用户信息中。")]),n("li",null,[n("a",j,[s("获取关注者用户列表"),e(a)]),s("，可以判断与用户是否关注")])])]),C]),D,M,n("p",null,[s("这五个问题可以在 "),n("a",O,[s("微信 H5 页面前端开发，大多数人都会遇到的几个兼容性坑"),e(a)]),s(" 中查看原因和解决方法")])])}const A=t(l,[["render",T],["__file","公众号网页开发经验总结.html.vue"]]);export{A as default};
